rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {

    // Users collection: only the authenticated user can read/write their own data
    match /users/{userId} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }

    // Elite Four Teams subcollection (User-scoped access)
    match /users/{userId}/elite_four_teams/{teamId} {
      // Owner Access: Allow all operations
      allow read, write: if request.auth != null && request.auth.uid == userId;

      // Admin Access: Allow all operations
      allow read, write: if request.auth != null && request.auth.token.admin == true;
    }

    // Collection Group query for public/admin reading of teams
    match /{path=**}/elite_four_teams/{teamId} {
      allow read: if resource.data.status == 'approved' || (request.auth != null && request.auth.token.admin == true);
    }

    // Pokedex collection: public read, admin write
    match /pokedex/{document=**} {
      allow read: if true;
      allow write: if request.auth != null && request.auth.token.admin == true;
    }
  }
}